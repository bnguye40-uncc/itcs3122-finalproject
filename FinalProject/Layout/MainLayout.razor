@inherits LayoutComponentBase
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject NavigationManager _navManager
@using FinalProject.Components.Pages.Objects

<PageTitle>WebLibrary</PageTitle>

<!-- Component -->
@if (_navManager.Uri.Contains("popup.html"))
{
    <div class="popup">
        @Body
    </div>
}
else
{
    <div class="page">
        <nav class="sidebar">
            <div class="root-folder-container">
                <CascadingValue Value="this">
                    <Folder @ref="rootFolderComponent" Class="root" Name="Your Bookmarks" Items=@RootFolder/>
                </CascadingValue>
            </div>
        </nav>

        <main>
            <header class="header">
                <a href="https://github.com/bnguye40-uncc/itcs3122-finalproject" target="_blank">About this project.</a>
            </header>
            <article class="content">
                @Body
            </article>
        </main>
    </div>
}

<!-- C# -->
@code {
    private List<AbstractFolderItem> RootFolder = new List<AbstractFolderItem>();
    private Folder? rootFolderComponent;
    public string rootFolderKey = "root-folder";

    protected override async Task OnInitializedAsync()
    {
        if (await localStorage.ContainKeyAsync(rootFolderKey)) {
            RootFolder = await localStorage.GetItemAsync<List<AbstractFolderItem>>(rootFolderKey);
        } else {
            await localStorage.SetItemAsync<List<AbstractFolderItem>>(rootFolderKey, RootFolder);
        }   
    }

    public async void UpdateLocalStorage() {
        await localStorage.SetItemAsync<List<AbstractFolderItem>>(rootFolderKey, RootFolder);
    }
}